import{u as F,a as B,b as M}from"./chunk-QIWEFQ5Y-DRn-xf5j.js";import{u as Q,a as H,b as K}from"./chunk-NLR7MGM2-CX1wOmyo.js";import{R as $,d as J,dQ as U,a as X,j as e,dB as Y,q as E,b as S,u as Z,dR as W,H as w,A as D,T as u,r as T,dI as V,k as G,dS as ee,bu as i,L as se,B as te,aK as re,p as ae,s as oe,t as f,dT as ie}from"./index-Bq0Gzu_3.js";import{S as ne}from"./chunk-UR2E444G-BOK0EhlY.js";import"./chunk-3IW4HYUP-B8Byj9_3.js";import{u as I,D as N}from"./chunk-OMP35ZTD-TafmhEGJ.js";import"./lodash-C7_NW7v3.js";import"./chunk-2XYHZG6S-C03r6v2Q.js";import"./chunk-E3YGDIJC-DwOUC-jK.js";import{P as z}from"./pencil-square-DJB9OGX8.js";import{T as O}from"./trash-WzBoCVyR.js";import{u as k}from"./use-prompt-DKUUp42P.js";import{C as _}from"./container-Dy7007w-.js";import{S as ce}from"./status-badge-XGUUJdyf.js";import{C as R}from"./checkbox-_V0gwTuy.js";import{c as le}from"./index-DSyUmAUn.js";import"./chunk-C76H5USB-B1mKOCrZ.js";import"./chunk-OI7BBNYW-BC_X2yeR.js";import"./chunk-P3UUX2T6-DJzunWlg.js";import"./chunk-B4FQDBC3-BUdDWcfy.js";import"./format-moz0PK7h.js";import"./chunk-LHJ6JQGA-BYkK2CbU.js";import"./chunk-FSMQADBD-DQ6u7KYm.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-XFSJ7YIN-CYgS8ok5.js";import"./chunk-ADOCJB6L-lgk_ht_6.js";import"./react-country-flag.esm-DLttq8Kn.js";import"./Trans-D-2atTey.js";import"./x-mark-mini-B2FnFGkK.js";import"./chunk-YEDAFXMB-BLUM5VK_.js";import"./chunk-AOFGTNG6-C3IFjf4O.js";import"./chunk-WX2SMNCD-CUPtxgvy.js";import"./plus-mini-D38qrUji.js";import"./command-bar-DD70Q2dm.js";import"./index-C99Xhc7P.js";import"./chunk-QAF7PVQE-Cn23_qPf.js";import"./date-picker-DLj21rEe.js";import"./popover-DVUhQEd-.js";import"./triangle-left-mini-C5FnHW24.js";import"./prompt-B670l_cz.js";var de=({customer:s})=>{const{t}=S(),r=k(),a=Z(),{mutateAsync:l}=W(s.id),c=[s.first_name,s.last_name].filter(Boolean).join(" "),o=s.has_account?"green":"orange",d=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),p=async()=>{await r({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await l(void 0,{onSuccess:()=>{f.success(t("customers.delete.successToast",{email:s.email})),a("/customers",{replace:!0})},onError:x=>{f.error(x.message)}})};return e.jsxs(_,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(w,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(ce,{color:o,children:d}),e.jsx(D,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(z,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(O,{}),onClick:p}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(u,{size:"small",leading:"compact",children:c||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(u,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(u,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},v=10,j="cusgr",me=({customer:s})=>{const t=k(),[r,a]=T.useState({}),{raw:l,searchParams:c}=F({pageSize:v,prefix:j}),{customer_groups:o,count:d,isLoading:p,isError:g,error:x}=V({...c,fields:"+customers.id",customers:{id:s.id}},{placeholderData:G}),{mutateAsync:h}=ee(s.id),y=B(),P=pe(s.id),{table:L}=I({data:o??[],columns:P,count:d,getRowId:m=>m.id,enablePagination:!0,enableRowSelection:!0,pageSize:v,prefix:j,rowSelection:{state:r,updater:a}}),q=async()=>{const m=Object.keys(r);if(await t({title:i("general.areYouSure"),description:i("customers.groups.removeMany",{groups:o==null?void 0:o.filter(n=>m.includes(n.id)).map(n=>n.name).join(",")}),confirmText:i("actions.remove"),cancelText:i("actions.cancel")}))try{await h({remove:m}),f.success(i("customers.groups.removed.success",{groups:o.filter(n=>m.includes(n.id)).map(n=>n==null?void 0:n.name)}))}catch(n){f.error(n.message)}};if(g)throw x;return e.jsxs(_,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(w,{level:"h2",children:i("customerGroups.domain")}),e.jsx(se,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(te,{variant:"secondary",size:"small",children:i("general.add")})})]}),e.jsx(N,{table:L,columns:P,pageSize:v,isLoading:p,count:d,prefix:j,navigateTo:m=>`/customer-groups/${m.id}`,filters:y,search:!0,pagination:!0,orderBy:[{key:"name",label:i("fields.name")},{key:"created_at",label:i("fields.createdAt")},{key:"updated_at",label:i("fields.updatedAt")}],commands:[{action:q,label:i("actions.remove"),shortcut:"r"}],queryObject:l,noRecords:{message:i("customers.groups.list.noRecordsMessage")}})]})},ue=({group:s,customerId:t})=>{const r=k(),{t:a}=S(),{mutateAsync:l}=ie(s.id),c=async()=>{await r({title:a("general.areYouSure"),description:a("customers.groups.remove",{name:s.name}),confirmText:a("actions.remove"),cancelText:a("actions.cancel")})&&await l([t],{onError:d=>{f.error(d.message)}})};return e.jsx(D,{groups:[{actions:[{label:a("actions.edit"),icon:e.jsx(z,{}),to:`/customer-groups/${s.id}/edit`},{label:a("actions.remove"),onClick:c,icon:e.jsx(O,{})}]}]})},A=le(),pe=s=>{const t=M();return T.useMemo(()=>[A.display({id:"select",header:({table:r})=>e.jsx(R,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:a=>r.toggleAllPageRowsSelected(!!a)}),cell:({row:r})=>e.jsx(R,{checked:r.getIsSelected(),onCheckedChange:a=>r.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}})}),...t,A.display({id:"actions",cell:({row:r})=>e.jsx(ue,{group:r.original,customerId:s})})],[t])},b="cusord",C=10,ge="*customer,*items,*sales_channel",xe="id,status,display_id,created_at,email,fulfillment_status,payment_status,total,currency_code",fe=({customer:s})=>{const{t}=S(),{searchParams:r,raw:a}=Q({pageSize:C,prefix:b}),{orders:l,count:c,isLoading:o,isError:d,error:p}=re({customer_id:s.id,fields:xe+","+ge,...r},{placeholderData:G}),g=he(),x=H(),{table:h}=I({data:l??[],columns:g,enablePagination:!0,count:c,pageSize:C,prefix:b});if(d)throw p;return e.jsxs(_,{className:"divide-y p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(w,{level:"h2",children:t("orders.domain")})}),e.jsx(N,{columns:g,table:h,pagination:!0,navigateTo:y=>`/orders/${y.original.id}`,filters:x,count:c,isLoading:o,pageSize:C,orderBy:[{key:"display_id",label:t("orders.fields.displayId")},{key:"created_at",label:t("fields.createdAt")},{key:"updated_at",label:t("fields.updatedAt")}],search:!0,queryObject:a,prefix:b})]})},he=()=>{const s=K({exclude:["customer"]});return T.useMemo(()=>[...s],[s])},is=()=>{const{id:s}=$(),t=J(),{customer:r,isLoading:a,isError:l,error:c}=U(s,void 0,{initialData:t}),{getWidgets:o}=X();if(a||!r)return e.jsx(Y,{sections:2,showJSON:!0,showMetadata:!0});if(l)throw c;return e.jsxs(ne,{widgets:{before:o("customer.details.before"),after:o("customer.details.after")},data:r,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(de,{customer:r}),e.jsx(fe,{customer:r}),e.jsx(me,{customer:r})]})},ye=s=>({queryKey:ae.detail(s),queryFn:async()=>oe.admin.customer.retrieve(s)}),ns=async({params:s})=>{const t=s.id,r=ye(t);return E.getQueryData(r.queryKey)??await E.fetchQuery(r)};export{is as Component,ns as loader};
