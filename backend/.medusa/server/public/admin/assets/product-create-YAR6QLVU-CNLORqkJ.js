import{C as ce}from"./chunk-X5VECN6S-C8por2p6.js";import{H as we}from"./chunk-7OYLCEKK-BP7qWr2s.js";import{u as Ne,a as de,D as Se,S as _e,b as Pe,c as ke,C as Ve,d as Ie,s as ze,K as Fe,P as Te,e as Ee,f as De}from"./sortable.esm-BRDqfFLR.js";import{u as Oe,a as Me,b as Ae}from"./chunk-VELNOPU6-Cyz4CmB6.js";import{r as y,g as Re,h as $e,i as Le,l as Be,j as e,m as he,I as ee,b as F,a as oe,n as qe,o as He,v as L,s as H,t as ae,w as Ke,B as M,F as xe,D as Ue,H as te,x as i,y as Z,z as K,T as J,A as Ge,X as We,C as U,E as Xe,G as Ze,J as Je,K as Qe}from"./index-Bq0Gzu_3.js";import{C as Ye}from"./chunk-74VVLHWF-Bra0nPLC.js";import{u as W}from"./chunk-6CNRNROJ-_52eRNKx.js";import{C as X}from"./chunk-BNH57GBH-Bw9lJ2z4.js";import{P as et,a as tt,n as st,U as at,d as ue}from"./chunk-ZC6J4336-BF4CgWVr.js";import"./chunk-QRQHBXSL-D57wry5N.js";import{D as A,c as rt,a as nt}from"./chunk-BTWRDYKW-DVbJl4m-.js";import{C as lt}from"./chunk-OEMJBX6M-CryhGS6c.js";import{u as it,D as ot}from"./chunk-OMP35ZTD-TafmhEGJ.js";import"./lodash-C7_NW7v3.js";import"./chunk-2XYHZG6S-C03r6v2Q.js";import"./chunk-E3YGDIJC-DwOUC-jK.js";import{S as fe}from"./chunk-PBUST3XI-DQn9iPPF.js";import{K as ct}from"./chunk-CEEYZHMN-CL6q0Lsw.js";import{R,u as ge,S as $,a as dt}from"./chunk-MDIOSTKB-CScRFmr1.js";import{P as T}from"./progress-tabs-FyRjNERx.js";import{T as ut}from"./textarea-BFY_BB84.js";import{T as mt}from"./thumbnail-badge-Bytg7GJD.js";import{T as pt}from"./trash-WzBoCVyR.js";import{A as re}from"./alert-DtdpqwtR.js";import{X as ve}from"./x-mark-mini-B2FnFGkK.js";import{T as ht}from"./Trans-D-2atTey.js";import{C as Q}from"./checkbox-_V0gwTuy.js";import{c as xt}from"./index-DSyUmAUn.js";import"./chunk-GA34GXNI-B6DfXUem.js";import"./chunk-P3UUX2T6-DJzunWlg.js";import"./chunk-OI7BBNYW-BC_X2yeR.js";import"./chunk-ADOCJB6L-lgk_ht_6.js";import"./chunk-C76H5USB-B1mKOCrZ.js";import"./triangles-mini-CJVmoiLK.js";import"./plus-mini-D38qrUji.js";import"./chunk-TYTNUPXB-D-YpmrFw.js";import"./chunk-6GU6IDUA-CDc7wW5L.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-C-qMPIPn.js";import"./index-oY_2eMsb.js";import"./proxy-Bw0yEXBv.js";import"./chunk-YEDAFXMB-BLUM5VK_.js";import"./chunk-AOFGTNG6-C3IFjf4O.js";import"./chunk-WX2SMNCD-CUPtxgvy.js";import"./command-bar-DD70Q2dm.js";import"./index-C99Xhc7P.js";import"./chunk-QAF7PVQE-Cn23_qPf.js";import"./format-moz0PK7h.js";import"./date-picker-DLj21rEe.js";import"./popover-DVUhQEd-.js";import"./triangle-left-mini-C5FnHW24.js";import"./prompt-B670l_cz.js";var ft=Object.defineProperty,Y=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable,me=(t,s,a)=>s in t?ft(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,gt=(t,s)=>{for(var a in s||(s={}))je.call(s,a)&&me(t,a,s[a]);if(Y)for(var a of Y(s))be.call(s,a)&&me(t,a,s[a]);return t},vt=(t,s)=>{var a={};for(var r in t)je.call(t,r)&&s.indexOf(r)<0&&(a[r]=t[r]);if(t!=null&&Y)for(var r of Y(t))s.indexOf(r)<0&&be.call(t,r)&&(a[r]=t[r]);return a};const ye=y.forwardRef((t,s)=>{var a=t,{color:r="currentColor"}=a,n=vt(a,["color"]);return y.createElement("svg",gt({xmlns:"http://www.w3.org/2000/svg",width:15,height:15,fill:"none",ref:s},n),y.createElement("path",{stroke:r,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"m2.389 10.389-.748.25a.444.444 0 0 1-.585-.422V4.783c0-.303.297-.517.585-.421l.748.25M5.944 12.055l-.718.3a.445.445 0 0 1-.615-.41v-8.89c0-.317.323-.532.615-.41l.718.3M8.798 1.124l4.631 2.137c.315.145.516.46.516.807v6.862a.89.89 0 0 1-.516.807l-4.631 2.137a.445.445 0 0 1-.631-.403V1.528c0-.325.336-.54.63-.404"}))});ye.displayName="StackPerspective";var jt=({form:t})=>{const{t:s}=F();return e.jsxs("div",{id:"general",className:"flex flex-col gap-y-6",children:[e.jsx("div",{className:"flex flex-col gap-y-2",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(i.Field,{control:t.control,name:"title",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{children:s("products.fields.title.label")}),e.jsx(i.Control,{children:e.jsx(Z,{...a,placeholder:"Winter jacket"})})]})}),e.jsx(i.Field,{control:t.control,name:"subtitle",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:s("products.fields.subtitle.label")}),e.jsx(i.Control,{children:e.jsx(Z,{...a,placeholder:"Warm and cosy"})})]})}),e.jsx(i.Field,{control:t.control,name:"handle",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{tooltip:s("products.fields.handle.tooltip"),optional:!0,children:s("fields.handle")}),e.jsx(i.Control,{children:e.jsx(we,{...a,placeholder:"winter-jacket"})})]})})]})}),e.jsx(i.Field,{control:t.control,name:"description",render:({field:a})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:s("products.fields.description.label")}),e.jsx(i.Control,{children:e.jsx(ut,{...a,placeholder:"A warm and cozy jacket"})})]})})]})},bt=({form:t})=>{const{fields:s,append:a,remove:r}=K({name:"media",control:t.control,keyName:"field_id"}),n=h=>()=>{r(h)},l=h=>()=>{const m=s.map((c,d)=>({...c,isThumbnail:d===h}));t.setValue("media",m,{shouldDirty:!0,shouldTouch:!0})},u=h=>({onDelete:n(h),onMakeThumbnail:l(h)});return e.jsxs("div",{id:"media",className:"flex flex-col gap-y-2",children:[e.jsx(at,{form:t,append:a,showHint:!1}),e.jsx("ul",{className:"flex flex-col gap-y-2",children:s.map((h,m)=>{const{onDelete:c,onMakeThumbnail:d}=u(m);return e.jsx(yt,{field:h,onDelete:c,onMakeThumbnail:d},h.id)})})]})},yt=({field:t,onDelete:s,onMakeThumbnail:a})=>{const{t:r}=F();return t.file?e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest flex items-center justify-between rounded-lg px-3 py-2",children:[e.jsxs("div",{className:"flex items-center gap-x-3",children:[e.jsx("div",{className:"bg-ui-bg-base h-10 w-[30px] overflow-hidden rounded-md",children:e.jsx(Ct,{file:t.file})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(J,{size:"small",leading:"compact",children:t.file.name}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[t.isThumbnail&&e.jsx(mt,{}),e.jsx(J,{size:"xsmall",leading:"compact",className:"text-ui-fg-subtle",children:wt(t.file.size)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(Ge,{groups:[{actions:[{label:r("products.media.makeThumbnail"),icon:e.jsx(ye,{}),onClick:a}]},{actions:[{icon:e.jsx(pt,{}),label:r("actions.delete"),onClick:s}]}]}),e.jsx(ee,{type:"button",size:"small",variant:"transparent",onClick:s,children:e.jsx(We,{})})]})]}):null},Ct=({file:t})=>{const[s,a]=y.useState(null);return y.useEffect(()=>{if(t){const r=URL.createObjectURL(t);return a(r),()=>URL.revokeObjectURL(r)}},[t]),s?e.jsx("img",{src:s,alt:"",className:"size-full object-cover object-center"}):null};function wt(t,s=2){if(t===0)return"0 Bytes";const a=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,n)).toFixed(s))+" "+r[n]}var Nt=({items:t,onChange:s,renderItem:a})=>{const[r,n]=y.useState(null),[l,u]=y.useMemo(()=>{if(r===null)return[null,null];const x=t.findIndex(({id:p})=>p===r.id);return[t[x],x]},[r,t]),h=Ne(de(Te),de(Fe,{coordinateGetter:ze})),m=({active:x})=>{n(x)},c=({active:x,over:p})=>{if(p&&x.id!==p.id){const I=t.findIndex(({id:P})=>P===x.id),_=t.findIndex(({id:P})=>P===p.id);s(Ee(t,I,_))}n(null)},d=()=>{n(null)};return e.jsxs(Se,{sensors:h,onDragStart:m,onDragEnd:c,onDragCancel:d,children:[e.jsx(_t,{children:l&&u!==null?a(l,u):null}),e.jsx(_e,{items:t,children:e.jsx("ul",{role:"application",className:"flex list-inside list-none list-image-none flex-col p-0",children:t.map((x,p)=>e.jsx(y.Fragment,{children:a(x,p)},x.id))})})]})},St={sideEffects:De({styles:{active:{opacity:"0.4"}}})},_t=({children:t})=>e.jsx(Pe,{className:"shadow-elevation-card-hover overflow-hidden rounded-md [&>li]:border-b-0",dropAnimation:St,children:t}),Ce=y.createContext(null),Pt=()=>{const t=y.useContext(Ce);if(!t)throw new Error("useSortableItemContext must be used within a SortableItemContext");return t},kt=({id:t,className:s,children:a})=>{const{attributes:r,isDragging:n,listeners:l,setNodeRef:u,setActivatorNodeRef:h,transform:m,transition:c}=ke({id:t}),d=y.useMemo(()=>({attributes:r,listeners:l,ref:h,isDragging:n}),[r,l,h,n]),x={opacity:n?.4:void 0,transform:Ve.Translate.toString(m),transition:c};return e.jsx(Ce.Provider,{value:d,children:e.jsx("li",{className:he("transition-fg flex flex-1 list-none",s),ref:u,style:x,children:a})})},Vt=()=>{const{attributes:t,listeners:s,ref:a}=Pt();return e.jsx(ee,{variant:"transparent",size:"small",...t,...s,ref:a,className:"cursor-grab touch-none active:cursor-grabbing",children:e.jsx(Ie,{className:"text-ui-fg-muted"})})},ne=Object.assign(Nt,{Item:kt,DragHandle:Vt}),ie=t=>{if(t.length===0)return[];if(t.length===1)return t[0].values.map(r=>({[t[0].title]:r}));const s=t[0],a=t.slice(1);return s.values.flatMap(r=>ie(a).map(n=>({[s.title]:r,...n})))},G=t=>Object.values(t).join(" / "),It=({form:t})=>{var P,E,D;const{t:s}=F(),a=K({control:t.control,name:"options"}),r=K({control:t.control,name:"variants"}),n=L({control:t.control,name:"enable_variants",defaultValue:!1}),l=L({control:t.control,name:"options",defaultValue:[]}),u=L({control:t.control,name:"variants",defaultValue:[]}),h=!!((P=t.formState.errors.options)!=null&&P.length),m=((D=(E=t.formState.errors.variants)==null?void 0:E.root)==null?void 0:D.message)==="invalid_length",c=(j,f)=>{const{isTouched:o}=t.getFieldState("variants"),v=[...l];v[j].values=f;const N=ie(v),b=[...u],S=g=>N.find(z=>Object.keys(g).every(V=>g[V]===z[V])),k=b.reduce((g,z)=>{const V=S(z.options);return V&&g.push({...z,title:G(V),options:V}),g},[]),C=new Set(k.map(g=>g.options));N.filter(g=>!C.has(g)).forEach(g=>{k.push({title:G(g),options:g,should_create:!o,variant_rank:k.length,inventory:[{inventory_item_id:"",required_quantity:""}]})}),t.setValue("variants",k)},d=j=>{if(j===0)return;a.remove(j);const f=[...l];f.splice(j,1);const o=ie(f),v=[...u],N=C=>o.find(w=>Object.keys(C).every(g=>C[g]===w[g])),b=v.reduce((C,w)=>{const g=N(w.options);return g&&C.push({...w,title:G(g),options:g}),C},[]),S=new Set(b.map(C=>C.options));o.filter(C=>!S.has(C)).forEach(C=>{b.push({title:G(C),options:C,should_create:!1,variant_rank:b.length})}),t.setValue("variants",b)},x=j=>{const f=j.map((o,v)=>{const N=u.find(b=>b.title===o.title);return{id:o.id,...N||o,variant_rank:v}});r.replace(f)},p=j=>j.every(f=>f.should_create)?!0:j.some(f=>f.should_create)?"indeterminate":!1,I=j=>{switch(j){case!0:{const f=u.map(o=>({...o,should_create:!0}));t.setValue("variants",f);break}case!1:{const f=u.map(o=>({...o,should_create:!1}));t.setValue("variants",ue(f));break}}},_=()=>{t.setValue("options",[{title:"Default option",values:["Default option value"]}]),t.setValue("variants",ue([{title:"Default variant",should_create:!0,variant_rank:0,options:{"Default option":"Default option value"},inventory:[{inventory_item_id:"",required_quantity:""}],is_default:!0}]))};return e.jsxs("div",{id:"variants",className:"flex flex-col gap-y-8",children:[e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(te,{level:"h2",children:s("products.create.variants.header")}),e.jsx(fe,{control:t.control,name:"enable_variants",label:s("products.create.variants.subHeadingTitle"),description:s("products.create.variants.subHeadingDescription"),onCheckedChange:j=>{j?(t.setValue("options",[{title:"",values:[]}]),t.setValue("variants",[])):_()}})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-y-6",children:e.jsx(i.Field,{control:t.control,name:"options",render:()=>e.jsx(i.Item,{children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(i.Label,{children:s("products.create.variants.productOptions.label")}),e.jsx(i.Hint,{children:s("products.create.variants.productOptions.hint")})]}),e.jsx(M,{size:"small",variant:"secondary",type:"button",onClick:()=>{a.append({title:"",values:[]})},children:s("actions.add")})]}),h&&e.jsx(re,{dismissible:!0,variant:"error",children:s("products.create.errors.options")}),e.jsx("ul",{className:"flex flex-col gap-y-4",children:a.fields.map((j,f)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${f}.title`,children:s("fields.title")})}),e.jsx(Z,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",...t.register(`options.${f}.title`),placeholder:s("products.fields.options.optionTitlePlaceholder")}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`options.${f}.values`,children:s("fields.values")})}),e.jsx(Xe,{control:t.control,name:`options.${f}.values`,render:({field:{onChange:o,...v}})=>{const N=b=>{c(f,b),o(b)};return e.jsx(lt,{...v,variant:"contrast",onChange:N,placeholder:s("products.fields.options.variantionsPlaceholder")})}})]}),e.jsx(ee,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",disabled:f===0,onClick:()=>d(f),children:e.jsx(ve,{})})]},j.id))})]})})})}),e.jsx("div",{className:"grid grid-cols-1 gap-x-4 gap-y-8",children:e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(U,{weight:"plus",children:s("products.create.variants.productVariants.label")}),e.jsx(Ze,{children:s("products.create.variants.productVariants.hint")})]}),!h&&m&&e.jsx(re,{dismissible:!0,variant:"error",children:s("products.create.errors.variants")}),r.fields.length>0?e.jsxs("div",{className:"overflow-hidden rounded-xl border",children:[e.jsxs("div",{className:"bg-ui-bg-component text-ui-fg-subtle grid items-center gap-3 border-b px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${l.length}, 1fr)`},children:[e.jsx("div",{children:e.jsx(Q,{checked:p(u),onCheckedChange:I})}),e.jsx("div",{}),l.map((j,f)=>e.jsx("div",{children:e.jsx(J,{size:"small",leading:"compact",weight:"plus",children:j.title})},f))]}),e.jsx(ne,{items:r.fields,onChange:x,renderItem:(j,f)=>e.jsx(ne.Item,{id:j.id,className:he("bg-ui-bg-base border-b",{"border-b-0":f===r.fields.length-1}),children:e.jsxs("div",{className:"text-ui-fg-subtle grid w-full items-center gap-3 px-6 py-2.5",style:{gridTemplateColumns:`20px 28px repeat(${l.length}, 1fr)`},children:[e.jsx(i.Field,{control:t.control,name:`variants.${f}.should_create`,render:({field:{value:o,onChange:v,...N}})=>e.jsx(i.Item,{children:e.jsx(i.Control,{children:e.jsx(Q,{...N,checked:o,onCheckedChange:v})})})}),e.jsx(ne.DragHandle,{}),Object.values(j.options).map((o,v)=>e.jsx(J,{size:"small",leading:"compact",children:o},v))]})})})]}):e.jsx(re,{children:s("products.create.variants.productVariants.alert")}),r.fields.length>0&&e.jsx(Je,{variant:"tip",children:s("products.create.variants.productVariants.tip")})]})})]})]})},zt=({form:t})=>{const{getFormFields:s}=oe(),a=s("product","create","general");return e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Ft,{}),e.jsxs("div",{className:"flex flex-col gap-y-6",children:[e.jsx(jt,{form:t}),e.jsx(xe,{fields:a,form:t}),e.jsx(bt,{form:t})]}),e.jsx(Ue,{}),e.jsx(It,{form:t})]})})},Ft=()=>{const{t}=F();return e.jsx("div",{className:"flex flex-col",children:e.jsx(te,{children:t("products.create.header")})})};function Tt({form:t,variant:s,index:a}){const{t:r}=F(),n=K({control:t.control,name:`variants.${a}.inventory`}),l=L({control:t.control,name:`variants.${a}.inventory`}),u=W({queryKey:["inventory_items"],queryFn:m=>H.admin.inventoryItem.list(m),getOptions:m=>m.inventory_items.map(c=>({label:c.title,value:c.id}))}),h=(m,c)=>l==null?void 0:l.some((d,x)=>x!=c&&d.inventory_item_id===m.value);return e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(i.Label,{children:s.title}),e.jsx(i.Hint,{children:r("products.create.inventory.label")})]}),e.jsx(M,{size:"small",variant:"secondary",type:"button",onClick:()=>{n.append({inventory_item_id:"",required_quantity:""})},children:r("actions.add")})]}),n.fields.map((m,c)=>e.jsxs("li",{className:"bg-ui-bg-component shadow-elevation-card-rest grid grid-cols-[1fr_28px] items-center gap-1.5 rounded-xl p-1.5",children:[e.jsxs("div",{className:"grid grid-cols-[min-content,1fr] items-center gap-1.5",children:[e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${a}.inventory.${c}.inventory_item_id`,children:r("fields.item")})}),e.jsx(i.Field,{control:t.control,name:`variants.${a}.inventory.${c}.inventory_item_id`,render:({field:d})=>e.jsx(i.Item,{children:e.jsx(i.Control,{children:e.jsx(X,{...d,options:u.options.map(x=>({...x,disabled:h(x,c)})),searchValue:u.searchValue,onSearchValueChange:u.onSearchValueChange,fetchNextPage:u.fetchNextPage,className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",placeholder:r("products.create.inventory.itemPlaceholder")})})})}),e.jsx("div",{className:"flex items-center px-2 py-1.5",children:e.jsx(U,{size:"xsmall",weight:"plus",className:"text-ui-fg-subtle",htmlFor:`variants.${a}.inventory.${c}.required_quantity`,children:r("fields.quantity")})}),e.jsx(i.Field,{control:t.control,name:`variants.${a}.inventory.${c}.required_quantity`,render:({field:{onChange:d,value:x,...p}})=>e.jsxs(i.Item,{children:[e.jsx(i.Control,{children:e.jsx(Z,{type:"number",className:"bg-ui-bg-field-component",min:0,value:x,onChange:I=>{const _=I.target.value;d(_===""?null:Number(_))},...p,placeholder:r("products.create.inventory.quantityPlaceholder")})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsx(ee,{type:"button",size:"small",variant:"transparent",className:"text-ui-fg-muted",onClick:()=>n.remove(c),children:e.jsx(ve,{})})]},m.id))]})}var Et=({form:t})=>{const{t:s}=F(),a=K({control:t.control,name:"variants"});return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(te,{children:s("products.create.inventory.heading")}),a.fields.filter(r=>r.inventory_kit).map((r,n)=>e.jsx(Tt,{form:t,variant:r,index:n},r.id))]})},Dt=({form:t})=>e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsx("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:e.jsx(Et,{form:t})})}),Ot=({form:t})=>{const{t:s}=F(),a=W({queryKey:["product_collections"],queryFn:c=>H.admin.productCollection.list(c),getOptions:c=>c.collections.map(d=>({label:d.title,value:d.id}))}),r=W({queryKey:["product_types"],queryFn:c=>H.admin.productType.list(c),getOptions:c=>c.product_types.map(d=>({label:d.value,value:d.id}))}),n=W({queryKey:["product_tags"],queryFn:c=>H.admin.productTag.list(c),getOptions:c=>c.product_tags.map(d=>({label:d.value,value:d.id}))}),{fields:l,remove:u,replace:h}=K({control:t.control,name:"sales_channels",keyName:"key"}),m=()=>{h([])};return e.jsxs("div",{id:"organize",className:"flex flex-col gap-y-8",children:[e.jsx(te,{children:s("products.organization.header")}),e.jsx(fe,{control:t.control,name:"discountable",label:s("products.fields.discountable.label"),description:s("products.fields.discountable.hint"),optional:!0}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(i.Field,{control:t.control,name:"type_id",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:s("products.fields.type.label")}),e.jsx(i.Control,{children:e.jsx(X,{...c,options:r.options,searchValue:r.searchValue,onSearchValueChange:r.onSearchValueChange,fetchNextPage:r.fetchNextPage})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:t.control,name:"collection_id",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:s("products.fields.collection.label")}),e.jsx(i.Control,{children:e.jsx(X,{...c,options:a.options,searchValue:a.searchValue,onSearchValueChange:a.onSearchValueChange,fetchNextPage:a.fetchNextPage})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(i.Field,{control:t.control,name:"categories",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:s("products.fields.categories.label")}),e.jsx(i.Control,{children:e.jsx(Ye,{...c})}),e.jsx(i.ErrorMessage,{})]})}),e.jsx(i.Field,{control:t.control,name:"tags",render:({field:c})=>e.jsxs(i.Item,{children:[e.jsx(i.Label,{optional:!0,children:s("products.fields.tags.label")}),e.jsx(i.Control,{children:e.jsx(X,{...c,options:n.options,searchValue:n.searchValue,onSearchValueChange:n.onSearchValueChange,fetchNextPage:n.fetchNextPage})}),e.jsx(i.ErrorMessage,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-y-4",children:e.jsx(i.Field,{control:t.control,name:"sales_channels",render:()=>e.jsxs(i.Item,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-x-4",children:[e.jsxs("div",{children:[e.jsx(i.Label,{optional:!0,children:s("products.fields.sales_channels.label")}),e.jsx(i.Hint,{children:e.jsx(ht,{i18nKey:"products.fields.sales_channels.hint"})})]}),e.jsx($.Trigger,{asChild:!0,children:e.jsx(M,{size:"small",variant:"secondary",type:"button",children:s("actions.add")})})]}),e.jsx(i.Control,{className:"mt-0",children:l.length>0&&e.jsx(ce,{onClearAll:m,onRemove:u,className:"py-4",children:l.map((c,d)=>e.jsx(ce.Chip,{index:d,children:c.name},c.key))})})]})})})]})},q="sc",le=50,Mt=({form:t})=>{const{t:s}=F(),{getValues:a,setValue:r}=t,{setIsOpen:n,getIsOpen:l}=dt(),[u,h]=y.useState({}),[m,c]=y.useState([]),{searchParams:d,raw:x}=Oe({pageSize:le,prefix:q}),{sales_channels:p,count:I,isLoading:_,isError:P,error:E}=Qe({...d}),D=l(q);y.useEffect(()=>{if(!D)return;const b=a("sales_channels");b&&(c(b.map(S=>({id:S.id,name:S.name}))),h(b.reduce((S,k)=>({...S,[k.id]:!0}),{})))},[D,a]);const j=b=>{const S=typeof b=="function"?b(u):b,k=Object.keys(S),C=new Set(k.filter(g=>S[g]&&!u[g]));let w=[];C.size>0&&(w=(p==null?void 0:p.filter(g=>C.has(g.id)))??[]),c(g=>{const z=g.filter(V=>S[V.id]);return Array.from(new Set([...z,...w]))}),h(S)},f=()=>{r("sales_channels",m,{shouldDirty:!0,shouldTouch:!0}),n(q,!1)},o=Me(),v=Rt(),{table:N}=it({data:p??[],columns:v,count:(p==null?void 0:p.length)??0,enablePagination:!0,enableRowSelection:!0,getRowId:b=>b.id,pageSize:le,rowSelection:{state:u,updater:j},prefix:q});if(P)throw E;return e.jsxs($.Content,{className:"flex flex-col overflow-hidden",children:[e.jsx($.Header,{}),e.jsx($.Body,{className:"flex-1 overflow-hidden",children:e.jsx(ot,{table:N,columns:v,pageSize:le,filters:o,isLoading:_,layout:"fill",orderBy:[{key:"name",label:s("fields.name")},{key:"created_at",label:s("fields.createdAt")},{key:"updated_at",label:s("fields.updatedAt")}],queryObject:x,search:!0,pagination:!0,count:I,prefix:q})}),e.jsx($.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx($.Close,{asChild:!0,children:e.jsx(M,{size:"small",variant:"secondary",type:"button",children:s("actions.cancel")})}),e.jsx(M,{size:"small",onClick:f,type:"button",children:s("actions.save")})]})})]})},At=xt(),Rt=()=>{const t=Ae();return y.useMemo(()=>[At.display({id:"select",header:({table:s})=>e.jsx(Q,{checked:s.getIsSomePageRowsSelected()?"indeterminate":s.getIsAllPageRowsSelected(),onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a)}),cell:({row:s})=>e.jsx(Q,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}})}),...t],[t])},$t=({form:t})=>{const{getFormFields:s}=oe(),a=s("product","create","organize");return e.jsxs($,{id:q,children:[e.jsx("div",{className:"flex flex-col items-center p-16",children:e.jsxs("div",{className:"flex w-full max-w-[720px] flex-col gap-y-8",children:[e.jsx(Ot,{form:t}),e.jsx(xe,{fields:a,form:t})]})}),e.jsx(Mt,{form:t})]})},Lt=({form:t,regions:s,store:a,pricePreferences:r})=>{const{setCloseOnEscape:n}=ge(),l=y.useMemo(()=>{var d;return((d=a==null?void 0:a.supported_currencies)==null?void 0:d.map(x=>x.currency_code))||[]},[a]),u=L({control:t.control,name:"variants",defaultValue:[]}),h=L({control:t.control,name:"options",defaultValue:[]}),m=Bt({options:h,currencies:l,regions:s,pricePreferences:r}),c=y.useMemo(()=>{const d=[];return u.forEach((x,p)=>{x.should_create&&d.push({...x,originalIndex:p})}),d},[u]);return e.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:e.jsx(A,{columns:m,data:c,state:t,onEditingChange:d=>n(!d)})})},B=nt(),Bt=({options:t,currencies:s=[],regions:a=[],pricePreferences:r=[]})=>{const{t:n}=F();return y.useMemo(()=>[B.column({id:"options",header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden",children:e.jsx("span",{className:"truncate",children:t.map(l=>l.title).join(" / ")})}),cell:l=>e.jsx(A.ReadonlyCell,{context:l,children:t.map(u=>l.row.original.options[u.title]).join(" / ")}),disableHiding:!0}),B.column({id:"title",name:n("fields.title"),header:n("fields.title"),field:l=>`variants.${l.row.original.originalIndex}.title`,type:"text",cell:l=>e.jsx(A.TextCell,{context:l})}),B.column({id:"sku",name:n("fields.sku"),header:n("fields.sku"),field:l=>`variants.${l.row.original.originalIndex}.sku`,type:"text",cell:l=>e.jsx(A.TextCell,{context:l})}),B.column({id:"manage_inventory",name:n("fields.managedInventory"),header:n("fields.managedInventory"),field:l=>`variants.${l.row.original.originalIndex}.manage_inventory`,type:"boolean",cell:l=>e.jsx(A.BooleanCell,{context:l})}),B.column({id:"allow_backorder",name:n("fields.allowBackorder"),header:n("fields.allowBackorder"),field:l=>`variants.${l.row.original.originalIndex}.allow_backorder`,type:"boolean",cell:l=>e.jsx(A.BooleanCell,{context:l})}),B.column({id:"inventory_kit",name:n("fields.inventoryKit"),header:n("fields.inventoryKit"),field:l=>`variants.${l.row.original.originalIndex}.inventory_kit`,type:"boolean",cell:l=>e.jsx(A.BooleanCell,{context:l,disabled:!l.row.original.manage_inventory})}),...rt({currencies:s,regions:a,pricePreferences:r,getFieldName:(l,u)=>{var h;return(h=l.column.id)!=null&&h.startsWith("currency_prices")?`variants.${l.row.original.originalIndex}.prices.${u}`:`variants.${l.row.original.originalIndex}.prices.${u}`},t:n})],[s,a,t,r,n])},pe="save-draft-button",qt=({defaultChannel:t,regions:s,store:a,pricePreferences:r})=>{const[n,l]=y.useState("details"),[u,h]=y.useState({details:"in-progress",organize:"not-started",variants:"not-started",inventory:"not-started"}),{t:m}=F(),{handleSuccess:c}=ge(),{getFormConfigs:d}=oe(),x=d("product","create"),p=qe({defaultValues:{...et,sales_channels:t?[{id:t.id,name:t.name}]:[]},schema:tt,configs:x}),{mutateAsync:I,isPending:_}=He(),P=y.useMemo(()=>s!=null&&s.length?s.reduce((o,v)=>(o[v.id]=v.currency_code,o),{}):{},[s]),E=L({control:p.control,name:"variants"}),D=y.useMemo(()=>E.some(o=>o.manage_inventory&&o.inventory_kit),[E]),j=p.handleSubmit(async(o,v)=>{var C;let N=!1;(v==null?void 0:v.nativeEvent)instanceof SubmitEvent&&(N=((C=v==null?void 0:v.nativeEvent)==null?void 0:C.submitter).dataset.name===pe);const b=o.media||[],S={...o,media:void 0};let k=[];try{if(b.length){const g=b.find(O=>O.isThumbnail),z=b.filter(O=>!O.isThumbnail),V=[];g&&V.push(H.admin.upload.create({files:[g.file]}).then(O=>O.files.map(se=>({...se,isThumbnail:!0})))),z!=null&&z.length&&V.push(H.admin.upload.create({files:z.map(O=>O.file)}).then(O=>O.files.map(se=>({...se,isThumbnail:!1})))),k=(await Promise.all(V)).flat()}const{product:w}=await I(st({...S,media:k,status:N?"draft":"published",regionsCurrencyMap:P}));ae.success(m("products.create.successToast",{title:w.title})),c(`../${w.id}`)}catch(w){Ke(w)&&w.status===400?ae.error(w.message):ae.error(m("general.error"),{description:w.message})}}),f=async o=>{await p.trigger()&&(o==="details"&&l("organize"),o==="organize"&&l("variants"),o==="variants"&&l("inventory"))};return y.useEffect(()=>{const o={...u};n==="details"&&(o.details="in-progress"),n==="organize"&&(o.details="completed",o.organize="in-progress"),n==="variants"&&(o.details="completed",o.organize="completed",o.variants="in-progress"),n==="inventory"&&(o.details="completed",o.organize="completed",o.variants="completed",o.inventory="in-progress"),h({...o})},[n]),e.jsx(R,{children:e.jsx(R.Form,{form:p,children:e.jsxs(ct,{onKeyDown:o=>{if(o.key==="Enter"&&(o.preventDefault(),o.metaKey||o.ctrlKey)){if(n!=="variants"){o.preventDefault(),o.stopPropagation(),f(n);return}j()}},onSubmit:j,className:"flex h-full flex-col",children:[e.jsxs(T,{value:n,onValueChange:async o=>{await p.trigger()&&l(o)},className:"flex h-full flex-col overflow-hidden",children:[e.jsx(R.Header,{children:e.jsx("div",{className:"-my-2 w-full border-l",children:e.jsxs(T.List,{className:"justify-start-start flex w-full items-center",children:[e.jsx(T.Trigger,{status:u.details,value:"details",className:"max-w-[200px] truncate",children:m("products.create.tabs.details")}),e.jsx(T.Trigger,{status:u.organize,value:"organize",className:"max-w-[200px] truncate",children:m("products.create.tabs.organize")}),e.jsx(T.Trigger,{status:u.variants,value:"variants",className:"max-w-[200px] truncate",children:m("products.create.tabs.variants")}),D&&e.jsx(T.Trigger,{status:u.inventory,value:"inventory",className:"max-w-[200px] truncate",children:m("products.create.tabs.inventory")})]})})}),e.jsxs(R.Body,{className:"size-full overflow-hidden",children:[e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"details",children:e.jsx(zt,{form:p})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"organize",children:e.jsx($t,{form:p})}),e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"variants",children:e.jsx(Lt,{form:p,store:a,regions:s,pricePreferences:r})}),D&&e.jsx(T.Content,{className:"size-full overflow-y-auto",value:"inventory",children:e.jsx(Dt,{form:p})})]})]}),e.jsx(R.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(R.Close,{asChild:!0,children:e.jsx(M,{variant:"secondary",size:"small",children:m("actions.cancel")})}),e.jsx(M,{"data-name":pe,size:"small",type:"submit",isLoading:_,className:"whitespace-nowrap",children:m("actions.saveAsDraft")}),e.jsx(Ht,{tab:n,next:f,isLoading:_,showInventoryTab:D})]})})]})})})},Ht=({tab:t,next:s,isLoading:a,showInventoryTab:r})=>{const{t:n}=F();return t==="variants"&&!r||t==="inventory"&&r?e.jsx(M,{"data-name":"publish-button",type:"submit",variant:"primary",size:"small",isLoading:a,children:n("actions.publish")},"submit-button"):e.jsx(M,{type:"button",variant:"primary",size:"small",onClick:()=>s(t),children:n("actions.continue")},"next-button")},qs=()=>{const{store:t,isPending:s,isError:a,error:r}=Re({fields:"default_sales_channel"}),{sales_channel:n,isPending:l,isError:u,error:h}=$e(t==null?void 0:t.default_sales_channel_id,{enabled:!!(t!=null&&t.default_sales_channel_id)}),{regions:m,isPending:c,isError:d,error:x}=Le({limit:9999}),{price_preferences:p,isPending:I,isError:_,error:P}=Be({limit:9999}),E=!!t&&!s&&!!m&&!c&&!!n&&!l&&!!p&&!I;if(a)throw r;if(d)throw x;if(u)throw h;if(_)throw P;return e.jsx(R,{children:E&&e.jsx(qt,{defaultChannel:n,store:t,pricePreferences:p,regions:m})})};export{qs as Component};
